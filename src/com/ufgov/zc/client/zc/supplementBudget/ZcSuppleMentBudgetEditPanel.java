/**   * @(#) project: zcxa* @(#) file: ZcSuppleMentBudgetEditPanel.java* * Copyright 2010 UFGOV, Inc. All rights reserved.* UFGOV PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.* */package com.ufgov.zc.client.zc.supplementBudget;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_FUND_CODE;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ORIGIN_CODE;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_ATTR2;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_CATALOGUE_CODE;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_CO_CODE_ND;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_CO_NAME;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_FGKZBFS_SMWJ;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_FIELD_ADD_MONEY;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_FUKUAN_TYPE;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_IS_IMP;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_MAKE_LINKMAN;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_MAKE_NAME;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_MAKE_SEQUENCE;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_MAKE_TEL;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_MONEY_BI_SUM;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_PIFU_CGFS;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_PITEM_ARR_DATE;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_PITEM_OPIWAY;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_TRUST_AGEY_CODE;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_TRUST_AGEY_NAME;import static com.ufgov.zc.common.system.constants.ZcElementConstants.FIELD_TRANS_ZC_ZG_CS_CODE;import com.ufgov.smartclient.common.UIUtilities;import com.ufgov.smartclient.component.table.JGroupableTableHeader;import com.ufgov.smartclient.component.table.fixedtable.JPageableFixedTable;import com.ufgov.zc.client.common.BillElementMeta;import com.ufgov.zc.client.common.LangTransMeta;import com.ufgov.zc.client.common.ListCursor;import com.ufgov.zc.client.common.MyTableModel;import com.ufgov.zc.client.common.ServiceFactory;import com.ufgov.zc.client.common.WorkEnv;import com.ufgov.zc.client.common.converter.zc.ZcSupplementPProMakeToTableModelConverter;import com.ufgov.zc.client.component.GkBaseDialog;import com.ufgov.zc.client.component.GkCommentDialog;import com.ufgov.zc.client.component.GkCommentUntreadDialog;import com.ufgov.zc.client.component.JFuncToolBar;import com.ufgov.zc.client.component.JTablePanel;import com.ufgov.zc.client.component.WorkflowTrace;import com.ufgov.zc.client.component.button.AddButton;import com.ufgov.zc.client.component.button.AuditPassButton;import com.ufgov.zc.client.component.button.CallbackButton;import com.ufgov.zc.client.component.button.DeleteButton;import com.ufgov.zc.client.component.button.EditButton;import com.ufgov.zc.client.component.button.ExitButton;import com.ufgov.zc.client.component.button.FuncButton;import com.ufgov.zc.client.component.button.NextButton;import com.ufgov.zc.client.component.button.PreviousButton;import com.ufgov.zc.client.component.button.SaveButton;import com.ufgov.zc.client.component.button.SendButton;import com.ufgov.zc.client.component.button.SubaddButton;import com.ufgov.zc.client.component.button.SubdelButton;import com.ufgov.zc.client.component.button.SubinsertButton;import com.ufgov.zc.client.component.button.SuggestAuditPassButton;import com.ufgov.zc.client.component.button.TraceButton;import com.ufgov.zc.client.component.button.UnauditButton;import com.ufgov.zc.client.component.button.UntreadButton;import com.ufgov.zc.client.component.button.zc.CommonButton;import com.ufgov.zc.client.component.table.BeanTableModel;import com.ufgov.zc.client.component.table.celleditor.DateCellEditor;import com.ufgov.zc.client.component.table.celleditor.IntCellEditor;import com.ufgov.zc.client.component.table.celleditor.MoneyCellEditor;import com.ufgov.zc.client.component.table.celleditor.TextCellEditor;import com.ufgov.zc.client.component.table.celleditor.zc.ZcBCatalogueCellEditor;import com.ufgov.zc.client.component.table.cellrenderer.DateCellRenderer;import com.ufgov.zc.client.component.table.cellrenderer.NumberCellRenderer;import com.ufgov.zc.client.component.table.codecelleditor.AsValComboBoxCellEditor;import com.ufgov.zc.client.component.table.codecelleditor.FileCellEditor;import com.ufgov.zc.client.component.table.codecellrenderer.AsValCellRenderer;import com.ufgov.zc.client.component.ui.fieldeditor.AbstractFieldEditor;import com.ufgov.zc.client.component.zc.AbstractMainSubEditPanel;import com.ufgov.zc.client.component.zc.fieldeditor.AsValFieldEditor;import com.ufgov.zc.client.component.zc.fieldeditor.AutoNumFieldEditor;import com.ufgov.zc.client.component.zc.fieldeditor.CompanyFieldEditor;import com.ufgov.zc.client.component.zc.fieldeditor.DateFieldEditor;import com.ufgov.zc.client.component.zc.fieldeditor.ForeignEntityFieldCellEditor;import com.ufgov.zc.client.component.zc.fieldeditor.ForeignEntityFieldEditor;import com.ufgov.zc.client.component.zc.fieldeditor.MoneyFieldEditor;import com.ufgov.zc.client.component.zc.fieldeditor.OrgFieldEditor;import com.ufgov.zc.client.component.zc.fieldeditor.TextFieldEditor;import com.ufgov.zc.client.util.SwingUtil;import com.ufgov.zc.client.zc.ButtonStatus;import com.ufgov.zc.client.zc.ZcUtil;import com.ufgov.zc.client.zc.zcppromake.ZcBudgetHandler;import com.ufgov.zc.client.zc.zcppromake.ZcPProMakeEditPanel.ZcEbBrandHandler;import com.ufgov.zc.client.zc.zcppromake.ZcPProMakeEditPanel.ZcEbMerHandler;import com.ufgov.zc.client.zc.zcppromake.ZcPProMakeEditPanel.ZcEbSupplierHandler;import com.ufgov.zc.common.system.Guid;import com.ufgov.zc.common.system.RequestMeta;import com.ufgov.zc.common.system.constants.ZcElementConstants;import com.ufgov.zc.common.system.constants.ZcSettingConstants;import com.ufgov.zc.common.system.dto.ElementConditionDto;import com.ufgov.zc.common.system.util.BeanUtil;import com.ufgov.zc.common.system.util.DigestUtil;import com.ufgov.zc.common.system.util.ObjectUtil;import com.ufgov.zc.common.system.util.Utils;import com.ufgov.zc.common.zc.foreignentity.IForeignEntityHandler;import com.ufgov.zc.common.zc.model.ZcBAgency;import com.ufgov.zc.common.zc.model.ZcPProMake;import com.ufgov.zc.common.zc.model.ZcPProMakeExt;import com.ufgov.zc.common.zc.model.ZcPProMitemBi;import com.ufgov.zc.common.zc.model.ZcQx;import com.ufgov.zc.common.zc.model.ZcSuppleMentBi;import com.ufgov.zc.common.zc.model.ZcSupplementPProMake;import com.ufgov.zc.common.zc.publish.IZcPProMakeServiceDelegate;import com.ufgov.zc.common.zc.publish.IZcSuppleMentPProMakeServiceDelegate;import java.awt.Color;import java.awt.DefaultKeyboardFocusManager;import java.awt.Dialog.ModalityType;import java.awt.BorderLayout;import java.awt.Dimension;import java.awt.Font;import java.awt.GridLayout;import java.awt.event.ActionEvent;import java.awt.event.ActionListener;import java.math.BigDecimal;import java.util.ArrayList;import java.util.Arrays;import java.util.List;import javax.swing.BorderFactory;import javax.swing.JButton;import javax.swing.JComponent;import javax.swing.JOptionPane;import javax.swing.JPanel;import javax.swing.JTabbedPane;import javax.swing.JTable;import javax.swing.border.TitledBorder;import javax.swing.event.TableModelEvent;import javax.swing.event.TableModelListener;import javax.swing.table.TableModel;import org.apache.commons.lang.ObjectUtils;import org.apache.log4j.Logger;/*** @ClassName: ZcSuppleMentBudgetEditPanel* @Description: TODO(这里用一句话描述这个类的作用)* @date: 2010-7-27 下午08:16:47* @version: V1.0 * @since: 1.0* @author: Administrator* @modify: */@SuppressWarnings("unchecked")public class ZcSuppleMentBudgetEditPanel extends AbstractMainSubEditPanel {  private static final long serialVersionUID = -2779110682087878491L;  private static final Logger logger = Logger.getLogger(ZcSuppleMentBudgetEditPanel.class);  private RequestMeta requestMeta = WorkEnv.getInstance().getRequestMeta();    protected String pageStatus = ZcSettingConstants.PAGE_STATUS_BROWSE;  private String compoId = "ZC_P_PRO_MAKE_SUPPLEMENT";  private FuncButton previousButton = new PreviousButton();  private FuncButton saveButton = new SaveButton();  private FuncButton deleteButton = new DeleteButton();  private FuncButton nextButton = new NextButton();  private FuncButton exitButton = new ExitButton();    protected FuncButton addButton = new AddButton();  protected FuncButton editButton = new EditButton();  // 工作流送审  private FuncButton sendButton = new SendButton();  // 工作流收回  private FuncButton callbackButton = new CallbackButton();  // 工作流填写意见审核通过  private FuncButton suggestPassButton = new SuggestAuditPassButton();  // 工作流审核通过  private FuncButton auditPassButton = new AuditPassButton();  // 工作流销审  private FuncButton unAuditButton = new UnauditButton();  // 工作流退回  private FuncButton unTreadButton = new UntreadButton();  // 工作流流程跟踪  private FuncButton traceButton = new TraceButton();  //追加按钮  private FuncButton addMoneyButton;  private ListCursor listCursor;  private ZcSupplementPProMake oldZcSupplementPProMake;  private String tabStatus;  private ZcEbSupplementBudgetListPanel listPanel;  private JTablePanel oldbiTablePanel = new JTablePanel();  private JTablePanel suppleMentBudgeTablePanel = new JTablePanel();  private JTablePanel itemTablePanel = new JTablePanel();  private ZcSuppleMentBudgetEditPanel self = this;  private ElementConditionDto zcPProMakeDao = new ElementConditionDto();  private ForeignEntityFieldEditor zcPProMakeSelectEdit;  private GkBaseDialog parent;  protected ElementConditionDto getBiDto = new ElementConditionDto();    private ArrayList<ButtonStatus> btnStatusList = new ArrayList<ButtonStatus>();//  private ZcPProMake zcPProMake;  private IZcSuppleMentPProMakeServiceDelegate zcSuppleMentPProMakeServiceDelegate = (IZcSuppleMentPProMakeServiceDelegate) ServiceFactory.create(    IZcSuppleMentPProMakeServiceDelegate.class,    "zcSuppleMentPProMakeServiceDelegate");  private IZcPProMakeServiceDelegate ZcPProMakeServiceDelegate = (IZcPProMakeServiceDelegate) ServiceFactory.create(IZcPProMakeServiceDelegate.class,    "zcPProMakeServiceDelegate");  public ZcSuppleMentBudgetEditPanel(GkBaseDialog parent, ListCursor listCursor, String tabStatus, ZcEbSupplementBudgetListPanel listPanel) {    super(ZcPProMake.class, listPanel.getBillElementMeta());    this.listCursor = listCursor;    this.tabStatus = tabStatus;    this.listPanel = listPanel;    this.workPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(), LangTransMeta.translate(compoId), TitledBorder.CENTER, TitledBorder.TOP,      new Font("宋体", Font.BOLD, 15), Color.BLUE));    this.parent = parent;    this.colCount = 3;    init();    requestMeta.setCompoId(compoId);    refreshData();  }  MoneyFieldEditor zcMoneyBiSum;  MoneyFieldEditor zcAddMoney;  @Override  public List<AbstractFieldEditor> createFieldEditors() {    List<AbstractFieldEditor> editorList = new ArrayList<AbstractFieldEditor>();      AutoNumFieldEditor zcSuppleMentCode = new AutoNumFieldEditor(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_SUPPLE_MENT_BUDGE_CODE),        "zcSuppleMentCode");    //添加一个选择项采购项目的web实体    String zcPProMakeColumNames[] = { "项目编号", "项目名称", "单位", "单位编号" };    ZcEbProMakeHandler handler2 = new ZcEbProMakeHandler(zcPProMakeColumNames);    zcPProMakeDao.setNd(requestMeta.getSvNd());    zcPProMakeDao.setZcText0("exec");    zcPProMakeDao.setCoCode(requestMeta.getSvCoCode());    zcPProMakeSelectEdit = new ForeignEntityFieldEditor("ZC_P_PRO_MAKE.getProMake", zcPProMakeDao, 20, handler2, zcPProMakeColumNames,      LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_MAKE_CODE),"zcMakeCode");    zcPProMakeSelectEdit.setEnabled(true);    TextFieldEditor zcMakeName = new TextFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_MAKE_NAME), "zcPProMake.zcMakeName");    zcMakeName.setEnabled(false);    AsValFieldEditor zcMakeStatus = new AsValFieldEditor("状态","zcSuppleMentStatus", "ZC_VS_MAKE_SUPPLEMENT_STATUS");    zcMakeStatus.setEnabled(false);    CompanyFieldEditor zcCoCode = new CompanyFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_CO_NAME), "zcPProMake.coCode");    zcCoCode.setEnabled(false);    OrgFieldEditor zcZgCsCode = new OrgFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_ZG_CS_CODE), "zcPProMake.orgCode", true);    zcZgCsCode.setEnabled(false);    TextFieldEditor zcMakeLinkman = new TextFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_MAKE_LINKMAN), "zcPProMake.zcMakeLinkman");    TextFieldEditor zcMakeTel = new TextFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_MAKE_TEL), "zcPProMake.zcMakeTel");            TextFieldEditor zcAttr2 = new TextFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_ATTR2), "zcPProMake.zcAttr2");        zcMoneyBiSum = new MoneyFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_MONEY_BI_SUM), "zcPProMake.zcMoneyBiSum");    zcMoneyBiSum.setEnabled(false);        zcAddMoney = new MoneyFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_FIELD_ADD_MONEY), "addMoney");    zcAddMoney.setEnabled(false);    AsValFieldEditor zcPifuCgfs = new AsValFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_PIFU_CGFS), "zcPProMake.zcPifuCgfs", "ZC_VS_PITEM_OPIWAY");    zcPifuCgfs.setEnabled(false);    AsValFieldEditor isCar = new AsValFieldEditor(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_P_PROMAKE_IS_CAR), "zcPProMake.isCar", "ZC_VS_YN");    AsValFieldEditor zcIsImp = new AsValFieldEditor(LangTransMeta.translate(FIELD_TRANS_ZC_IS_IMP), "zcPProMake.zcIsImp", "VS_Y/N");      DateFieldEditor zcInputDate = new DateFieldEditor(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_INPUT_DATE), "zcInputDate");    TextFieldEditor zcRemark = new TextFieldEditor(LangTransMeta.translate(ZcElementConstants.FIELD_TRANS_ZC_REMARK), "zcRemark");    editorList.add(zcSuppleMentCode);    editorList.add(zcPProMakeSelectEdit);    editorList.add(zcMakeName);        editorList.add(zcCoCode);    editorList.add(zcAttr2);    editorList.add(zcMakeLinkman);        editorList.add(zcMoneyBiSum);    editorList.add(zcPifuCgfs);    editorList.add(zcMakeTel);    editorList.add(zcAddMoney);    editorList.add(zcZgCsCode);    editorList.add(isCar);        editorList.add(zcIsImp);     editorList.add(zcRemark);    editorList.add(zcInputDate);    editorList.add(zcMakeStatus);    return editorList;  }  @Override  public JTablePanel[] getSubTables() {    return new JTablePanel[] { oldbiTablePanel, itemTablePanel, suppleMentBudgeTablePanel };  }  JFuncToolBar bottomToolBar1 = null;  JFuncToolBar bottomToolBar2 = null;  JFuncToolBar bottomToolBar3 = null;  private void setItemBiDefaultValue(ZcPProMitemBi zcPProMitemBi) {    zcPProMitemBi.setFundCode("1");    zcPProMitemBi.setOriginCode("1");    zcPProMitemBi.setPaytypeCode("1");  }  JTabbedPane biTabPane = null;  JTabbedPane itemTabPane = null;  @Override  public JComponent createSubBillPanel() {    biTabPane = new JTabbedPane();    oldbiTablePanel.init();    oldbiTablePanel.getSearchBar().setVisible(false);    oldbiTablePanel.setTablePreferencesKey(this.getClass().getName() + "_oldbiTable");    oldbiTablePanel.getTable().setShowCheckedColumn(true);    oldbiTablePanel.getTable().getTableRowHeader().setPreferredSize(new Dimension(60, 0));    oldbiTablePanel.setPanelId("1");        suppleMentBudgeTablePanel.init();    suppleMentBudgeTablePanel.getSearchBar().setVisible(false);    suppleMentBudgeTablePanel.setTablePreferencesKey(this.getClass().getName() + "_newbiTable");    suppleMentBudgeTablePanel.getTable().setShowCheckedColumn(true);    suppleMentBudgeTablePanel.getTable().getTableRowHeader().setPreferredSize(new Dimension(60, 0));        suppleMentBudgeTablePanel.setPanelId("2");    JFuncToolBar biBottomToolBar = new JFuncToolBar();    FuncButton addBtn1 = new SubaddButton(false);    JButton insertBtn1 = new SubinsertButton(false);    JButton delBtn1 = new SubdelButton(false);        biBottomToolBar.add(addBtn1);    biBottomToolBar.add(insertBtn1);    biBottomToolBar.add(delBtn1);    addBtn1.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        ZcPProMitemBi zcPProMitemBi = new ZcPProMitemBi();        zcPProMitemBi.setTempId(Guid.genID());        setItemBiDefaultValue(zcPProMitemBi);        // setListDefaultValue(asVal);        int rowNum = addSub(suppleMentBudgeTablePanel, zcPProMitemBi);        suppleMentBudgeTablePanel.getTable().setRowSelectionInterval(rowNum, rowNum);      }    });    insertBtn1.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        ZcPProMitemBi zcPProMitemBi = new ZcPProMitemBi();        zcPProMitemBi.setTempId(Guid.genID());        setItemBiDefaultValue(zcPProMitemBi);        int rowNum = insertSub(suppleMentBudgeTablePanel, zcPProMitemBi);        suppleMentBudgeTablePanel.getTable().setRowSelectionInterval(rowNum, rowNum);      }    });    delBtn1.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        Integer[] checkedRows = deleteBiSub(suppleMentBudgeTablePanel);        // 从新计算采购预算        if (checkedRows.length > 0) {          self.caculateMoney(((BeanTableModel) suppleMentBudgeTablePanel.getTable().getModel()).getDataBeanList());        }      }    });    suppleMentBudgeTablePanel.add(biBottomToolBar, BorderLayout.SOUTH);    biTabPane.addTab("追加资金", suppleMentBudgeTablePanel);    itemTabPane = new JTabbedPane();    itemTablePanel.init();    itemTablePanel.getSearchBar().setVisible(false);    itemTablePanel.setTablePreferencesKey(this.getClass().getName() + "_itemTable");    itemTablePanel.getTable().setShowCheckedColumn(true);    itemTablePanel.getTable().getTableRowHeader().setPreferredSize(new Dimension(60, 0));    itemTablePanel.setPanelId("3");    itemTabPane.addTab("资金构成", oldbiTablePanel);    itemTabPane.addTab("计划明细", itemTablePanel);    JGroupableTableHeader itemTableHeader = itemTablePanel.getTable().getTableHeader();    itemTableHeader.addColumnGroup("采购预算资金", new String[] { "ZC_FIELD_ZC_ITEM_SUM", "BUDGET_BI_MONEY", "BUDGET_OTHER_MONEY" });    JPanel panel = new JPanel(new GridLayout(2, 1));    panel.add(itemTabPane);    panel.add(biTabPane);    return panel;  }  /*   *    * 从表的删除行方法   */  protected Integer[] deleteBiSub(JTablePanel tablePanel) {    JPageableFixedTable table = tablePanel.getTable();    Integer[] checkedRows;    // 是否显示行选择框    if (tablePanel.getTable().isShowCheckedColumn()) {      checkedRows = table.getCheckedRows();    } else {      int[] selectedRows = table.getSelectedRows();      checkedRows = new Integer[selectedRows.length];      for (int i = 0; i < checkedRows.length; i++) {        checkedRows[i] = selectedRows[i];      }    }    if (checkedRows.length == 0) {      JOptionPane.showMessageDialog(this, "没有选择数据！", "提示",      JOptionPane.INFORMATION_MESSAGE);    } else {      if (table.isEditing()) {        table.getCellEditor().stopCellEditing();      }      BeanTableModel tableModel = (BeanTableModel) table.getModel();      int[] selRows = new int[checkedRows.length];      for (int i = 0; i < selRows.length; i++) {        selRows[i] = table.convertRowIndexToModel(checkedRows[i]);      }      Arrays.sort(selRows);      for (int i = selRows.length - 1; i >= 0; i--) {        if (ZcUtil.useBudget()) {          ZcPProMitemBi bi = (ZcPProMitemBi) ((ZcPProMake) listCursor.getCurrentObject()).getBiList().get(selRows[i]);          if (bi.getZcBiNo() != null && !"".equals(bi.getZcBiNo())) {            getBiDto.setZcText3(getBiDto.getZcText3().replaceAll(",'" + bi.getZcBiNo() + "'", "").replaceAll("'" + bi.getZcBiNo() + "',", "")              .replaceAll("'" + bi.getZcBiNo() + "'", ""));          }        }        tableModel.deleteRow(selRows[i]);      }    }    fitColumnWidth(tablePanel.getTable());    return checkedRows;  }  @Override  public void initToolBar(JFuncToolBar toolBar) {    toolBar.setModuleCode("ZC");    toolBar.setCompoId(compoId);    toolBar.add(editButton);        toolBar.add(saveButton);    toolBar.add(sendButton);    toolBar.add(suggestPassButton);    toolBar.add(auditPassButton);    toolBar.add(callbackButton);    toolBar.add(unAuditButton);    toolBar.add(unTreadButton);    toolBar.add(traceButton);    toolBar.add(deleteButton);    toolBar.add(previousButton);    toolBar.add(nextButton);    toolBar.add(exitButton);    saveButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        stopTableEditing();        // 保存        doSave();      }    });    deleteButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        stopTableEditing();        // 删除        doDelete();      }    });    sendButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        stopTableEditing();        // 送审        doSend();      }    });    callbackButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        stopTableEditing();        // 收回        doCallback();      }    });    suggestPassButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent arg0) {        stopTableEditing();        // 填写意见审核        doSuggestPass();      }    });    auditPassButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        stopTableEditing();        // 审核        doAudit();      }    });    unAuditButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        stopTableEditing();        // 销审        doUnaudit();      }    });    unTreadButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        stopTableEditing();        // 退回        doUntread();      }    });    traceButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        // 流程跟踪        doTrace();      }    });    previousButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        // 上一页        doPrevious();      }    });    nextButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        // 下一页        doNext();      }    });    exitButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        // 退出        doExit();      }    });    editButton.addActionListener(new ActionListener() {      public void actionPerformed(ActionEvent e) {        // 退出        doEdit();      }    });  }  private void doEdit() {    this.pageStatus = ZcSettingConstants.PAGE_STATUS_EDIT;    updateFieldEditorsEditable();    ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();        setButtonStatus(bean, requestMeta, this.listCursor);  }  private void refreshAll(ZcSupplementPProMake afterSaveBill, boolean isRefreshButton) {    this.listCursor.setCurrentObject(afterSaveBill);    refreshData();    if (isRefreshButton) {      setButtonStatus(afterSaveBill, requestMeta, this.listCursor);    }  }  /*   * 流程跟踪   */  private void doTrace() {    if (this.listCursor.getCurrentObject() == null) {      return;    }        ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();        if(bean == null){    	    	return;    }    ZcUtil.showTraceDialog(bean, compoId);  }  private void doSend() {    boolean success = true;    ZcSupplementPProMake afterSaveBill = null;    String errorInfo = "";    if (checkBeforeSave()) {      return;    }    if (isDataChanged()) {      JOptionPane.showMessageDialog(this, "数据发生改变，请先保存.", "提示", JOptionPane.INFORMATION_MESSAGE);      return;    }    try {      requestMeta.setFuncId(this.sendButton.getFuncId());      ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();      bean.setAuditorId(WorkEnv.getInstance().getCurrUserId());      bean.setComment("同意");      afterSaveBill = zcSuppleMentPProMakeServiceDelegate.newCommitFN(bean, requestMeta);    } catch (Exception ex) {      errorInfo += ex.getMessage();      logger.error(ex.getMessage(), ex);      success = false;      UIUtilities.showStaickTraceDialog(ex, this, "错误", ex.getMessage());    }    if (success) {      this.refreshAll(afterSaveBill, true);      JOptionPane.showMessageDialog(this, "送审成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      this.listPanel.refreshCurrentTabData();    }  }  /*   * 收回   */  private void doCallback() {    boolean success = true;    ZcSupplementPProMake afterSaveBill = null;    String errorInfo = "";    try {      requestMeta.setFuncId(this.callbackButton.getFuncId());      ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();      bean.setAuditorId(WorkEnv.getInstance().getCurrUserId());      afterSaveBill = zcSuppleMentPProMakeServiceDelegate.callbackFN(bean, requestMeta);    } catch (Exception e) {      success = false;      logger.error(e.getMessage(), e);      errorInfo += e.getMessage();    }    if (success) {      this.refreshAll(afterSaveBill, true);      JOptionPane.showMessageDialog(this, "收回成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      this.listPanel.refreshCurrentTabData();    } else {      JOptionPane.showMessageDialog(this, "收回失败 ！" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);    }  }  /*   * 填写意见审核   */  private void doSuggestPass() {    if (checkBeforeSave()) {      return;    }    if (isDataChanged()) {      JOptionPane.showMessageDialog(this, "数据发生改变，请先保存.", "提示", JOptionPane.INFORMATION_MESSAGE);      return;    }    GkCommentDialog commentDialog = new GkCommentDialog(DefaultKeyboardFocusManager.getCurrentKeyboardFocusManager().getActiveWindow(),      ModalityType.APPLICATION_MODAL);    if (commentDialog.cancel) {      return;    }    boolean success = true;    ZcSupplementPProMake afterSaveBill = null;    String errorInfo = "";    try {      requestMeta.setFuncId(this.suggestPassButton.getFuncId());      ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();      bean.setComment(commentDialog.getComment());      bean.setAuditorId(WorkEnv.getInstance().getCurrUserId());      afterSaveBill = zcSuppleMentPProMakeServiceDelegate.auditFN(bean, requestMeta);    } catch (Exception e) {      success = false;      logger.error(e.getMessage(), e);      errorInfo += e.getMessage();    }    if (success) {      this.refreshAll(afterSaveBill, true);      JOptionPane.showMessageDialog(this, "审核成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      this.listPanel.refreshCurrentTabData();    } else {      JOptionPane.showMessageDialog(this, "审核失败 ！" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);    }  }  /*   * 审核   */  private void doAudit() {    if (checkBeforeSave()) {      return;    }    if (isDataChanged()) {      JOptionPane.showMessageDialog(this, "数据发生改变，请先保存.", "提示", JOptionPane.INFORMATION_MESSAGE);      return;    }    boolean success = true;    ZcSupplementPProMake afterSaveBill = null;    String errorInfo = "";    try {      requestMeta.setFuncId(this.auditPassButton.getFuncId());      ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();      bean.setAuditorId(WorkEnv.getInstance().getCurrUserId());      afterSaveBill = zcSuppleMentPProMakeServiceDelegate.auditFN(bean, requestMeta);    } catch (Exception e) {      success = false;      logger.error(e.getMessage(), e);      errorInfo += e.getMessage();    }    if (success) {      this.refreshAll(afterSaveBill, true);      JOptionPane.showMessageDialog(this, "审核成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      this.listPanel.refreshCurrentTabData();    } else {      JOptionPane.showMessageDialog(this, "审核失败 ！" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);    }  }  /*   * 销审   */  private void doUnaudit() {    boolean success = true;    ZcSupplementPProMake afterSaveBill = null;    String errorInfo = "";    try {      requestMeta.setFuncId(unAuditButton.getFuncId());      ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();      bean.setAuditorId(WorkEnv.getInstance().getCurrUserId());      afterSaveBill = zcSuppleMentPProMakeServiceDelegate.unAuditFN(bean, requestMeta);    } catch (Exception e) {      success = false;      logger.error(e.getMessage(), e);      errorInfo += e.getMessage();    }    if (success) {      this.refreshAll(afterSaveBill, true);      JOptionPane.showMessageDialog(this, "销审成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      this.listPanel.refreshCurrentTabData();    } else {      JOptionPane.showMessageDialog(this, "销审失败 ！" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);    }  }  /*   * 退回   */  private void doUntread() {    if (checkBeforeSave()) {      return;    }    if (isDataChanged()) {      JOptionPane.showMessageDialog(this, "数据发生改变，请先保存.", "提示", JOptionPane.INFORMATION_MESSAGE);      return;    }    GkCommentUntreadDialog commentDialog = new GkCommentUntreadDialog(DefaultKeyboardFocusManager.getCurrentKeyboardFocusManager().getActiveWindow(),      ModalityType.APPLICATION_MODAL);    if (commentDialog.cancel) {      return;    }    boolean success = true;    ZcSupplementPProMake afterSaveBill = null;    String errorInfo = "";    try {      requestMeta.setFuncId(unTreadButton.getFuncId());      ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();      bean.setAuditorId(WorkEnv.getInstance().getCurrUserId());      bean.setComment(commentDialog.getComment());      afterSaveBill = zcSuppleMentPProMakeServiceDelegate.untreadFN(bean, requestMeta);    } catch (Exception e) {      success = false;      logger.error(e.getMessage(), e);      errorInfo += e.getMessage();    }    if (success) {      this.refreshAll(afterSaveBill, true);      JOptionPane.showMessageDialog(this, "退回成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      this.listPanel.refreshCurrentTabData();    } else {      JOptionPane.showMessageDialog(this, "退回失败 ！" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);    }  }  private void doPrevious() {    if (isDataChanged()) {      int num = JOptionPane.showConfirmDialog(this, "当前页面数据已修改，是否要保存", "保存确认", 0);      if (num == JOptionPane.YES_OPTION) {        if (!doSave()) {          return;        }      } else {        listCursor.setCurrentObject(oldZcSupplementPProMake);      }    }    listCursor.previous();    refreshData();  }  private void doNext() {    if (isDataChanged()) {      int num = JOptionPane.showConfirmDialog(this, "当前页面数据已修改，是否要保存", "保存确认", 0);      if (num == JOptionPane.YES_OPTION) {        if (!doSave()) {          return;        }      } else {        listCursor.setCurrentObject(oldZcSupplementPProMake);      }    }    listCursor.next();    refreshData();  }  public boolean doExit() {/*    if (isDataChanged()) {      int num = JOptionPane.showConfirmDialog(this, "当前页面数据已修改，是否要保存", "保存确认", 0);      if (num == JOptionPane.YES_OPTION) {        if (!doSave()) {          return false;        }      }    }*/    this.parent.dispose();    return true;  }  /**   * 保存前校验   * @param cpApply   * @return   */  private boolean checkBeforeSave() {    ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();    StringBuilder errorInfo = new StringBuilder();        if(bean.getZcMakeCode()==null || bean.getZcMakeCode().length()==0){      errorInfo.append("请选择一个采购计划！\n");    }    BigDecimal addMoney = bean.getAddMoney();    if (addMoney == null || addMoney.doubleValue() == 0.00) {      errorInfo.append("追加金额不能为零！\n");    }    if (errorInfo.length() != 0) {      JOptionPane.showMessageDialog(this, errorInfo.toString(), "提示", JOptionPane.WARNING_MESSAGE);      return true;    }    return false;  }  /**   *   * @Description: TODO，对通过审核的采购追加资金，将追加的金额加入到计划的采购预算中去。并且也要修改  * @return void 返回类型  * @since 1.0   */  public void doAddMoney() {    ZcSupplementPProMake bean = ((ZcSupplementPProMake) this.listCursor.getCurrentObject());    BigDecimal addMoney = bean.getAddMoney();    ZcPProMake zcPProMake = bean.getZcPProMake();    BigDecimal zcMoneyBiSum = zcPProMake.getZcMoneyBiSum();    zcPProMake.setZcMoneyBiSum(zcMoneyBiSum.add(addMoney));    boolean success = true;    String errorInfo = "";    try {      //将资金追加到采购计划中去，并修改采购计划的明细。      requestMeta.setFuncId(addMoneyButton.getFuncId());      zcSuppleMentPProMakeServiceDelegate.addMoneyFN(bean, requestMeta);      //修改追加资金的状态，为已追加。    } catch (Exception e) {      logger.error(e.getMessage(), e);      success = false;      errorInfo += e.getMessage();    }    if (success) {      JOptionPane.showMessageDialog(this, "保存成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      refreshData();      this.listPanel.refreshCurrentTabData();    } else {      JOptionPane.showMessageDialog(this, "保存失败 ！\n" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);    }  }  public boolean doSave() {    if (checkBeforeSave()) {      return false;    }    if (!isDataChanged()) {      JOptionPane.showMessageDialog(this, "数据没有发生改变，不用保存.", "提示", JOptionPane.INFORMATION_MESSAGE);      return true;    }    boolean success = true;    String errorInfo = "";    try {      requestMeta.setFuncId(saveButton.getFuncId());      ZcSupplementPProMake zcSupplementPProMake = (ZcSupplementPProMake) ObjectUtil.deepCopy(this.listCursor.getCurrentObject());      zcSupplementPProMake = zcSuppleMentPProMakeServiceDelegate.updateZcSupplementPProMakeFN(zcSupplementPProMake, requestMeta);      listCursor.setCurrentObject(zcSupplementPProMake);    } catch (Exception e) {      logger.error(e.getMessage(), e);      success = false;      errorInfo += e.getMessage();    }    if (success) {      JOptionPane.showMessageDialog(this, "保存成功！", "提示", JOptionPane.INFORMATION_MESSAGE);      refreshData();      this.listPanel.refreshCurrentTabData();    } else {      JOptionPane.showMessageDialog(this, "保存失败 ！\n" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);    }    return true;  }  protected void doDelete() {    int num = JOptionPane.showConfirmDialog(this, "是否删除当前单据", "删除确认", 0);    if (num == JOptionPane.YES_OPTION) {      boolean success = true;      ZcSupplementPProMake zcSupplementPProMake = null;      String errorInfo = "";      try {        requestMeta.setFuncId(deleteButton.getFuncId());        zcSupplementPProMake = (ZcSupplementPProMake) this.listCursor.getCurrentObject();        this.listPanel.getZcSuppleMentPProMakeServiceDelegate().deleteZcSupplementPProMakeFN(zcSupplementPProMake, requestMeta);      } catch (Exception e) {        logger.error(e.getMessage(), e);        success = false;        errorInfo += e.getMessage();      }      if (success) {        this.listCursor.removeCurrentObject();        JOptionPane.showMessageDialog(this, "删除成功！", "提示", JOptionPane.INFORMATION_MESSAGE);        this.refreshData();        this.listPanel.refreshCurrentTabData();      } else {        JOptionPane.showMessageDialog(this, "保存失败 ！\n" + errorInfo, "错误", JOptionPane.ERROR_MESSAGE);      }    }  }  private void stopTableEditing() {    JPageableFixedTable biTable = this.oldbiTablePanel.getTable();    if (biTable.isEditing()) {      biTable.getCellEditor().stopCellEditing();    }    JPageableFixedTable suppleMentBudageTable = this.suppleMentBudgeTablePanel.getTable();    if (suppleMentBudageTable.isEditing()) {      suppleMentBudageTable.getCellEditor().stopCellEditing();    }    JPageableFixedTable itemTable = this.itemTablePanel.getTable();    if (itemTable.isEditing()) {      itemTable.getCellEditor().stopCellEditing();    }  }  public boolean isDataChanged() {    stopTableEditing();    return !DigestUtil.digest(oldZcSupplementPProMake).equals(DigestUtil.digest(listCursor.getCurrentObject()));  }  private void refreshData() {    ZcSupplementPProMake bean = (ZcSupplementPProMake) listCursor.getCurrentObject();    if (bean != null) {      this.pageStatus = ZcSettingConstants.PAGE_STATUS_BROWSE;      try {        if (bean.getZcSuppleMentCode() != null) {          bean = this.listPanel.getZcSuppleMentPProMakeServiceDelegate().getZcSupplementPProMake(bean.getZcSuppleMentCode(), requestMeta);        }      } catch (Exception e) {        e.printStackTrace();                JOptionPane.showMessageDialog(this, e.getMessage(), "系统错误", JOptionPane.ERROR_MESSAGE);                return;      }      List newBiLst=bean.getSuppleMentBiList();      if (newBiLst != null && newBiLst.size() > 0) {        if (ZcUtil.useBudget()) {          String biNoStrs = "";          for (int i = 0; i < newBiLst.size(); i++) {            ZcPProMitemBi bi = (ZcPProMitemBi) newBiLst.get(i);            if (bi.getZcBiNo() == null || "".equals(bi.getZcBiNo())) {              bi.setZcBiDoSum(null);              continue;            }            if (biNoStrs.length() > 0) {              biNoStrs = biNoStrs + ",'" + bi.getZcBiNo() + "'";            } else {              biNoStrs = "'" + bi.getZcBiNo() + "'";            }          }          getBiDto.setZcText3(biNoStrs);        }      }      if (ZcUtil.useBudget()) {        getBiDto.setZcMakeCode(bean.getZcSuppleMentCode());      }    } else {      this.pageStatus = ZcSettingConstants.PAGE_STATUS_NEW;      bean = new ZcSupplementPProMake();      bean.setZcSuppleMentStatus("0");      bean.setZcInputCode(requestMeta.getSvUserID());      bean.setZcInputName(requestMeta.getSvUserName());      bean.setZcInputDate(requestMeta.getSysDate());      bean.setNd(requestMeta.getSvNd());      bean.setCoCode(requestMeta.getSvCoCode());            listCursor.getDataList().add(bean);      bean.setSuppleMentBiList(new ArrayList());        ZcPProMake zcPProMake = new ZcPProMake();        zcPProMake.setBiList(new ArrayList());        zcPProMake.setItemList(new ArrayList());        bean.setZcPProMake(zcPProMake);    }    if (ZcUtil.useBudget()) {      getBiDto.setNd(requestMeta.getSvNd());      getBiDto.setZcText2("1");//对应sql语句里是可用指标金额>0      getBiDto.setCoCode(bean.getCoCode() != null ? bean.getCoCode() : requestMeta.getSvCoCode());    }    this.setEditingObject(bean);    listCursor.setCurrentObject(bean);    refreshSubTable();        //设置追加金额输入框是否可编辑//    boolean isEdit = false;//    if (this.listCursor.getCurrentObject() != null && "0".equals(((ZcSupplementPProMake) this.listCursor.getCurrentObject()).getZcSuppleMentStatus())) {//      isEdit = true;//    }    // 根据工作流模版设置功能按钮是否可用    setButtonStatus((ZcSupplementPProMake) this.listCursor.getCurrentObject(), requestMeta, this.listCursor);    if (this.listCursor.getCurrentObject() != null      && "toadd".equals(((ZcSupplementPProMake) this.listCursor.getCurrentObject()).getZcSuppleMentStatus())) {      callbackButton.setVisible(false);    }    addNewBiTableLisenter(suppleMentBudgeTablePanel.getTable());    setOldObject();    this.initScrollBarValue();    updateFieldEditorsEditable();        biTabPane.repaint();    itemTabPane.repaint();    suppleMentBudgeTablePanel.repaint();  }  protected void updateFieldEditorsEditable() {    ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();    Long processInstId = bean.getProcessInstId();    if (processInstId != null && processInstId.longValue() > 0) {      // 工作流的单据      wfCanEditFieldMap = BillElementMeta.getWfCanEditField(bean, requestMeta);      for (AbstractFieldEditor editor : fieldEditors) {        // 工作流中定义可编辑的字段        if (wfCanEditFieldMap != null && wfCanEditFieldMap.containsKey(Utils.getDBColNameByFieldName(editor.getEditObject(), editor.getFieldName()))) {          isEdit = true;          this.pageStatus = ZcSettingConstants.PAGE_STATUS_EDIT;          editor.setEnabled(true);        } else {          editor.setEnabled(false);        }      }      //工作流中该节点选中了保存按钮可用，则当前状态当前人可用编辑      if (saveButton.isVisible() && saveButton.isEnabled()) {        isEdit = true;        this.pageStatus = ZcSettingConstants.PAGE_STATUS_EDIT;      }    } else {      for (AbstractFieldEditor editor : fieldEditors) {        if (pageStatus.equals(ZcSettingConstants.PAGE_STATUS_EDIT) || pageStatus.equals(ZcSettingConstants.PAGE_STATUS_NEW)) {          if ("zcMakeCode".equals(editor.getFieldName()) ||"zcRemark".equals(editor.getFieldName())) {            editor.setEnabled(true);          } else {            editor.setEnabled(false);          }          isEdit = true;        } else {          editor.setEnabled(false);        }      }    }    setWFSubTableEditable(oldbiTablePanel, false);    setWFSubTableEditable(itemTablePanel, false);    setWFSubTableEditable(suppleMentBudgeTablePanel, isEdit);  }  public void setButtonStatusWithoutWf(){    if (this.btnStatusList.size() == 0) {      ButtonStatus bs = new ButtonStatus();      bs.setButton(this.addButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addBillStatus(ZcSettingConstants.BILL_STATUS_ALL);      btnStatusList.add(bs);      bs.setButton(this.editButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addBillStatus(ZcSettingConstants.WF_STATUS_DRAFT);      btnStatusList.add(bs);      bs = new ButtonStatus();      bs.setButton(this.saveButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_EDIT);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_NEW);      btnStatusList.add(bs);            bs = new ButtonStatus();      bs.setButton(this.deleteButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addPageStatus(ZcSettingConstants.WF_STATUS_DRAFT);      btnStatusList.add(bs);      bs = new ButtonStatus();      bs.setButton(this.exitButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_ALL);      bs.addBillStatus(ZcSettingConstants.BILL_STATUS_ALL);      btnStatusList.add(bs);      bs = new ButtonStatus();      bs.setButton(this.sendButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_EDIT);      bs.addBillStatus(ZcSettingConstants.BILL_STATUS_ALL);      btnStatusList.add(bs);      bs = new ButtonStatus();      bs.setButton(this.suggestPassButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addBillStatus(ZcSettingConstants.BILL_STATUS_ALL);      btnStatusList.add(bs);      bs = new ButtonStatus();      bs.setButton(this.callbackButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addBillStatus(ZcSettingConstants.BILL_STATUS_ALL);      btnStatusList.add(bs);      bs = new ButtonStatus();      bs.setButton(this.unAuditButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addBillStatus(ZcSettingConstants.BILL_STATUS_ALL);      btnStatusList.add(bs);      bs = new ButtonStatus();      bs.setButton(this.unTreadButton);      bs.addPageStatus(ZcSettingConstants.PAGE_STATUS_BROWSE);      bs.addBillStatus(ZcSettingConstants.BILL_STATUS_ALL);      btnStatusList.add(bs);    }    ZcSupplementPProMake bean = (ZcSupplementPProMake) this.listCursor.getCurrentObject();    String billStatus = bean.getZcSuppleMentStatus();    ZcUtil.setButtonEnable(this.btnStatusList, billStatus, this.pageStatus, getCompoId(), bean.getProcessInstId());      }    public void addNewBiTableLisenter(JPageableFixedTable table) {    final BeanTableModel model = (BeanTableModel) table.getModel();    model.addTableModelListener(new TableModelListener() {      public void tableChanged(TableModelEvent e) {        if (e.getColumn() >= 0 && "ZC_BI_JHUA_SUM".equals(model.getColumnIdentifier(e.getColumn()))) {          self.caculateMoney(model.getDataBeanList());        }      }    });  }  private void refreshSubTable(){    refreshMakeSubTable();    refreshNewBiTable();  }    private void refreshMakeSubTable(){    ZcSupplementPProMake bean = (ZcSupplementPProMake) listCursor.getCurrentObject();    itemTablePanel.setTableModel(ZcSupplementPProMakeToTableModelConverter.convertSubItemTableData(bean.getZcPProMake().getItemList()));    oldbiTablePanel.setTableModel(ZcSupplementPProMakeToTableModelConverter.convertSubBiTableData(bean.getZcPProMake().getBiList()));    ZcUtil.translateColName(itemTablePanel.getTable(), ZcSupplementPProMakeToTableModelConverter.getItemInfo());    ZcUtil.translateColName(oldbiTablePanel.getTable(), ZcSupplementPProMakeToTableModelConverter.getBiInfoWihtBudget());    setTableBiEditor(oldbiTablePanel.getTable());    setTableItemEditor(itemTablePanel.getTable());  }    private void refreshNewBiTable(){    ZcSupplementPProMake bean = (ZcSupplementPProMake) listCursor.getCurrentObject();    suppleMentBudgeTablePanel.setTableModel(ZcSupplementPProMakeToTableModelConverter.convertSubSuppleMentBudgeTableData(bean.getSuppleMentBiList(),isEdit));    // 翻译从表表头列    ZcUtil.translateColName(suppleMentBudgeTablePanel.getTable(), ZcSupplementPProMakeToTableModelConverter.getBiInfoWihtBudget());    setTablesuppleMentBudgeEditor(suppleMentBudgeTablePanel.getTable());  }  private void initScrollBarValue() {    oldbiTablePanel.getScrollPane().getHorizontalScrollBar().setValue(0);    oldbiTablePanel.getScrollPane().getVerticalScrollBar().setValue(0);    suppleMentBudgeTablePanel.getScrollPane().getHorizontalScrollBar().setValue(0);    suppleMentBudgeTablePanel.getScrollPane().getVerticalScrollBar().setValue(0);    itemTablePanel.getScrollPane().getHorizontalScrollBar().setValue(0);    itemTablePanel.getScrollPane().getVerticalScrollBar().setValue(0);  }  //  private void addBiTableLisenter(JPageableFixedTable table) {  //    BeanTableModel model1 = (BeanTableModel) (suppleMentBudgeTablePanel.getTable().getModel());  //    final BeanTableModel model2 = (BeanTableModel) (table.getModel());  //    model2.addTableModelListener(new TableModelListener() {  //      public void tableChanged(TableModelEvent e) {  //        if (e.getColumn() >= 0 && "ZC_BI_JHUA_SUM".equals(model2.getColumnIdentifier(e.getColumn()))) {  //          self.caculateMoney(model2.getDataBeanList());  //        }  //      }  //    });  //  }  protected void caculateMoney(List<ZcPProMitemBi> biList) {    BigDecimal sum = BigDecimal.ZERO;    for (ZcPProMitemBi bi : biList) {      sum = sum.add((BigDecimal) ObjectUtils.defaultIfNull(bi.getZcBiJhuaSum(), new BigDecimal("0.00")));    }    ZcSupplementPProMake bean = ((ZcSupplementPProMake) this.listCursor.getCurrentObject());    if (sum.compareTo(bean.getAddMoney()==null? BigDecimal.ZERO:bean.getAddMoney()) != 0) {      bean.setAddMoney(sum);      this.setEditingObject(bean);    }  }  private void setTableBiEditor(JTable table) {    table.setDefaultEditor(String.class, new TextCellEditor());    SwingUtil.setTableCellEditor(table, "ZC_BI_SUM", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "ZC_BI_SUM", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "ZC_BI_DO_SUM", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "ZC_BI_DO_SUM", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "ZC_BI_JHUA_SUM", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "ZC_BI_JHUA_SUM", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "ZC_BI_YJBA_SUM", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "ZC_BI_YJBA_SUM", new NumberCellRenderer());  }  private void setTablesuppleMentBudgeEditor(JTable table) {    table.setDefaultEditor(String.class, new TextCellEditor());    if (ZcUtil.useBudget()) {      String colNames[] = { "指标余额表ID", "指标来源", "发文文号", "资金性质","采购项目", "功能分类", "经济分类","是否监督使用","是否政府采购","指标总金额","指标可用金额" };      ZcBudgetHandler budgetHandler = new ZcBudgetHandler(colNames, suppleMentBudgeTablePanel, this, listCursor, getBiDto);      //只显示政府采购的指标，汽修、汽保可以显示全部指标，参见汽修、汽保的选择部件      getBiDto.setDattr1("zfcg");      ForeignEntityFieldCellEditor suEditor = new ForeignEntityFieldCellEditor("VwBudgetGp.getVwBudgetGp", getBiDto, 20, budgetHandler, colNames,        "资金构成", "sumId");      SwingUtil.setTableCellEditor(table, "ZC_BI_NO", suEditor);      SwingUtil.setTableCellEditor(table, "ZC_BI_SUM", new MoneyCellEditor(false));      SwingUtil.setTableCellRenderer(table, "ZC_BI_SUM", new NumberCellRenderer());      SwingUtil.setTableCellEditor(table, "ZC_BI_DO_SUM", new MoneyCellEditor(false));      SwingUtil.setTableCellRenderer(table, "ZC_BI_DO_SUM", new NumberCellRenderer());      SwingUtil.setTableCellEditor(table, "ZC_BI_JHUA_SUM", new MoneyCellEditor(false));      SwingUtil.setTableCellRenderer(table, "ZC_BI_JHUA_SUM", new NumberCellRenderer());      SwingUtil.setTableCellEditor(table, "ZC_BI_YJBA_SUM", new MoneyCellEditor(false));      SwingUtil.setTableCellRenderer(table, "ZC_BI_YJBA_SUM", new NumberCellRenderer());    }else{    SwingUtil.setTableCellEditor(table, "ZC_BI_JHUA_SUM", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "ZC_BI_JHUA_SUM", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "ZC_BI_YJBA_SUM", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "ZC_BI_YJBA_SUM", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, FIELD_TRANS_FUND_CODE, new AsValComboBoxCellEditor("ZC_VS_FUND_NAME"));    SwingUtil.setTableCellRenderer(table, ZcElementConstants.FIELD_TRANS_FUND_CODE, new AsValCellRenderer("ZC_VS_FUND_NAME"));    SwingUtil.setTableCellEditor(table, FIELD_TRANS_ORIGIN_CODE, new AsValComboBoxCellEditor("ZC_VS_ORIGIN_NAME"));    SwingUtil.setTableCellRenderer(table, ZcElementConstants.FIELD_TRANS_ORIGIN_CODE, new AsValCellRenderer("ZC_VS_ORIGIN_NAME"));    SwingUtil.setTableCellEditor(table, ZcElementConstants.FIELD_TRANS_PAYTYPE_CODE, new AsValComboBoxCellEditor("ZC_VS_PAYTYPE_NAME"));    SwingUtil.setTableCellRenderer(table, ZcElementConstants.FIELD_TRANS_PAYTYPE_CODE, new AsValCellRenderer("ZC_VS_PAYTYPE_NAME"));    SwingUtil.setTableCellEditor(table, "ZC_FUND_FILE", new FileCellEditor("zcFundFileBlobid", (BeanTableModel) table.getModel()));//    String status = ((ZcPProMake) listCursor.getCurrentObject()).getZcMakeStatus();////    if (!"exec".equals(status) && !"yjz".equals(status)) {////      table.getTableHeader().getColumnModel().removeColumn(table.getColumn("ZC_BI_YJBA_SUM"));////    }    }  }  private void setTableItemEditor(JTable table) {    table.setDefaultEditor(String.class, new TextCellEditor());    SwingUtil.setTableCellEditor(table, FIELD_TRANS_ZC_PITEM_ARR_DATE, new DateCellEditor());    SwingUtil.setTableCellRenderer(table, FIELD_TRANS_ZC_PITEM_ARR_DATE, new DateCellRenderer());    SwingUtil.setTableCellEditor(table, FIELD_TRANS_ZC_CATALOGUE_CODE, new ZcBCatalogueCellEditor(false, false));    SwingUtil.setTableCellEditor(table, ZcElementConstants.FIELD_TRANS_ZC_PITEM_ATTACH, new FileCellEditor("zcPitemAttachBlobid",    (BeanTableModel) table.getModel()));    MoneyCellEditor mce = new MoneyCellEditor(false);    mce.getField().setEnabled(false);    SwingUtil.setTableCellEditor(table, "ZC_FIELD_ZC_ITEM_SUM", mce);    SwingUtil.setTableCellRenderer(table, "ZC_FIELD_ZC_ITEM_SUM", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "BUDGET_BI_MONEY", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "BUDGET_BI_MONEY", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "BUDGET_OTHER_MONEY", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "BUDGET_OTHER_MONEY", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "ZC_MER_PRICE", new MoneyCellEditor(false));    SwingUtil.setTableCellRenderer(table, "ZC_MER_PRICE", new NumberCellRenderer());    SwingUtil.setTableCellEditor(table, "ZC_FIELD_ZC_CAIG_NUM", new MoneyCellEditor(false));  }  private void setOldObject() {    oldZcSupplementPProMake = (ZcSupplementPProMake) ObjectUtil.deepCopy(listCursor.getCurrentObject());  }  private BillElementMeta biBillElementMeta = BillElementMeta.getBillElementMetaWithoutNd("ZC_P_PRO_MITEM_BI");  private BillElementMeta itemBillElementMeta = BillElementMeta.getBillElementMetaWithoutNd("ZC_P_PRO_MITEM");  private class ZcAgeyFnHandler implements IForeignEntityHandler {    private String columNames[];    public ZcAgeyFnHandler(String columNames[]) {      this.columNames = columNames;    }    public void excute(List selectedDatas) {      ZcPProMake zcPProMake = (ZcPProMake) listCursor.getCurrentObject();      for (Object object : selectedDatas) {        ZcBAgency zcBAgency = (ZcBAgency) object;        zcPProMake.setAgency(zcBAgency.getAgency());        zcPProMake.setAgencyName(zcBAgency.getAgencyName());        setEditingObject(zcPProMake);      }    }    @Override    public TableModel createTableModel(List showDatas) {      Object data[][] = new Object[showDatas.size()][columNames.length];      for (int i = 0; i < showDatas.size(); i++) {        ZcBAgency rowData = (ZcBAgency) showDatas.get(i);        int col = 0;        data[i][col++] = rowData.getAgency();        data[i][col++] = rowData.getAgencyName();      }      MyTableModel model = new MyTableModel(data, columNames) {        private static final long serialVersionUID = 1821460782676810898L;        public boolean isCellEditable(int row, int colum) {          return false;        }        public Class getColumnClass(int column) {          if ((column >= 0) && (column < getColumnCount()) && this.getRowCount() > 0) {            for (int row = 0; row < this.getRowCount(); row++) {              if (getValueAt(row, column) != null) {                return getValueAt(row, column).getClass();              }            }          }          return Object.class;        }      };      return model;    }    @Override    public boolean isMultipleSelect() {      return false;    }  }  /**   * 选择采购项目的web实体   */  private class ZcEbProMakeHandler implements IForeignEntityHandler {    private String columNames[];    public ZcEbProMakeHandler(String columNames[]) {      this.columNames = columNames;    }    public void excute(List selectedDatas) {      for (Object object : selectedDatas) {        ZcPProMake zcPProMake = (ZcPProMake) object;        ZcSupplementPProMake bean = (ZcSupplementPProMake) listCursor.getCurrentObject();                zcPProMake = ZcPProMakeServiceDelegate.selectByPrimaryKey(zcPProMake.getZcMakeCode(), requestMeta);        bean.setZcMakeCode(zcPProMake.getZcMakeCode());        bean.setZcPProMake(zcPProMake);        setEditingObject(bean);        refreshMakeSubTable();      }    }    @Override    public TableModel createTableModel(List showDatas) {      Object data[][] = new Object[showDatas.size()][columNames.length];      for (int i = 0; i < showDatas.size(); i++) {        ZcPProMakeExt rowData = (ZcPProMakeExt) showDatas.get(i);        int col = 0;        data[i][col++] = rowData.getZcMakeCode();        data[i][col++] = rowData.getZcMakeName();        data[i][col++] = rowData.getCoCode();        data[i][col++] = rowData.getCoName();      }      MyTableModel model = new MyTableModel(data, columNames) {        public boolean isCellEditable(int row, int colum) {          return false;        }      };      return model;    }    @Override    public boolean isMultipleSelect() {      // TCJLODO Auto-generated method stub      return false;    }  }  /*private void copyProMakeToCurrenObject(ZcPProMake zcPProMake, ZcSupplementPProMake bean) {    if (zcPProMake.getZcMakeLinkman() != null) {      bean.setZcMakeLinkman(zcPProMake.getZcMakeLinkman());    }    if (zcPProMake.getZcMakeTel() != null) {      bean.setZcMakeTel(zcPProMake.getZcMakeTel());    }    if (zcPProMake.getAgency() != null) {      bean.setZcAgeyCode(zcPProMake.getAgency());    }    if (zcPProMake.getAgencyName() != null) {      bean.setZcAgeyName(zcPProMake.getAgencyName());    }    if (zcPProMake.getZcMakeSequence() != null) {      bean.setZcMakeSequence(zcPProMake.getZcMakeSequence());    }    if (zcPProMake.getZcFukuanType() != null) {      bean.setZcFukuanType(zcPProMake.getZcFukuanType());    }    if (zcPProMake.getZcPitemOpiway() != null) {      bean.setZcPitemOpiway(zcPProMake.getZcPitemOpiway());    }    if (zcPProMake.getZcPifuCgfs() != null) {      bean.setZcPifuCgfs(zcPProMake.getZcPifuCgfs());    }    if (zcPProMake.getZcFgkzbfsSmwj() != null) {      bean.setZcFgkzbfsSmwj(zcPProMake.getZcFgkzbfsSmwj());    }    if (zcPProMake.getZcIsImp() != null) {      bean.setZcIsImp(zcPProMake.getZcIsImp());    }    if (zcPProMake.getZcIsBudget() != null) {      bean.setZcIsBudget(zcPProMake.getZcIsBudget());    }    if (zcPProMake.getZcMoneyBiSum() != null) {      bean.setZcMoneyBiSum(zcPProMake.getZcMoneyBiSum());    }    if (zcPProMake.getZcMakeName() != null) {      bean.setZcMakeName(zcPProMake.getZcMakeName());    }    if (zcPProMake.getNd() != 0) {      bean.setNd(zcPProMake.getNd());    }    if (zcPProMake.getCoCode() != null) {      bean.setZcCoCode(zcPProMake.getCoCode());    }    if (zcPProMake.getOrgCode() != null) {      bean.setZcZgCsCode(zcPProMake.getOrgCode());    }  }*/}